# –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä Nord City

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö Python-—Å–µ—Ä–≤–∏—Å–æ–≤
–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –û–¥–∏–Ω `.env`, –æ–¥–∏–Ω `venv`, –æ–¥–∏–Ω `requirements.txt`.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `infrastructure/orchestrator.py`

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
cd infrastructure
source venv/bin/activate
python orchestrator.py
```

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ | `python orchestrator.py` |
| –ó–∞–ø—É—Å–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö | `python orchestrator.py --services db,web` |
| –ê–≤—Ç–æ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | `--services bot` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç `db` |
| Foreground-—Ä–µ–∂–∏–º | `python orchestrator.py --service db` |
| –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ | `python orchestrator.py --list` |
| Live-–¥–∞—à–±–æ—Ä–¥ | –¢–∞–±–ª–∏—Ü–∞ rich —Å PID, —Å—Ç–∞—Ç—É—Å–æ–º, –ø–æ—Ä—Ç–æ–º, uptime, –ª–æ–≥–∞–º–∏ |
| Graceful shutdown | Ctrl+C ‚Äî –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Subprocess-–º–æ–¥–µ–ª—å

–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ **–æ—Ç–¥–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ** —á–µ—Ä–µ–∑ `subprocess.Popen`:

- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (–æ—Ç–¥–µ–ª—å–Ω—ã–µ PID, –ø–æ—Ç–æ–∫–∏, event loops)
- –ü–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
- stdout/stderr –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –±—É—Ñ–µ—Ä–∏–∑—É–µ—Ç—Å—è
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–ª–µ–¥–∏—Ç –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —á–µ—Ä–µ–∑ `process.poll()`

### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞

```
1. db  (database_service, –ø–æ—Ä—Ç 8001)  ‚Äî –ø–µ—Ä–≤—ã–º, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. web (web_service, –ø–æ—Ä—Ç 8003)       ‚Äî –ø–æ—Å–ª–µ db (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç db)
3. bot (bot_service, Telegram)        ‚Äî –ø–æ—Å–ª–µ db (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç db)
```

–ú–µ–∂–¥—É –∑–∞–ø—É—Å–∫–æ–º –∑–∞–≤–∏—Å–∏–º–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî –ø–∞—É–∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã.

### –ü–æ—Ä—è–¥–æ–∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

–û–±—Ä–∞—Ç–Ω—ã–π: bot ‚Üí web ‚Üí db. –ö–∞–∂–¥–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É –ø–æ—Å—ã–ª–∞–µ—Ç—Å—è SIGTERM,
–ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ ‚Äî SIGKILL.

---

## –°–µ—Ä–≤–∏—Å—ã

| Alias | –ù–∞–∑–≤–∞–Ω–∏–µ | –ü–æ—Ä—Ç | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç |
|-------|----------|------|-------------|------------|
| `db`  | Database Service | 8001 | `services/database_service/src/main.py` | ‚Äî |
| `web` | Web Service | 8003 | `services/web_service/src/main.py` | db |
| `bot` | Bot Service | ‚Äî | `services/bot_service/src/main.py` | db |

–ü–æ—Ä—Ç—ã —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`DATABASE_SERVICE_PORT`,
`WEB_SERVICE_PORT`). –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî 8001 –∏ 8003.

---

## CLI

```
usage: orchestrator [-h] [--services ALIASES] [--service ALIAS]
                    [--list] [--env-file PATH]

options:
  --services, -s ALIASES   –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
  --service ALIAS           –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –≤ foreground (–±–µ–∑ –¥–∞—à–±–æ—Ä–¥–∞)
  --list, -l                –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –≤—ã–π—Ç–∏
  --env-file PATH           –ü—É—Ç—å –∫ .env —Ñ–∞–π–ª—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é infrastructure/.env)
```

### –ü—Ä–∏–º–µ—Ä—ã

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
python orchestrator.py

# –¢–æ–ª—å–∫–æ database + web
python orchestrator.py --services db,web

# –ë–æ—Ç (db –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)
python orchestrator.py --services bot

# –û–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –≤ foreground (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
python orchestrator.py --service db

# –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
python orchestrator.py --list
```

---

## Live-–¥–∞—à–±–æ—Ä–¥

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç live-–ø–∞–Ω–µ–ª—å:

```
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Nord City Orchestrator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ Service            Alias  Status       PID     Port   Uptime  ‚îÇ
‚îÇ Database Service    db    ‚óè RUNNING    12345   8001   00:05:23‚îÇ
‚îÇ Web Service         web   ‚óè RUNNING    12346   8003   00:05:21‚îÇ
‚îÇ Bot Service         bot   ‚óè RUNNING    12347    -     00:05:19‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ Recent logs:                                                  ‚îÇ
‚îÇ [ db] 2026-02-09 12:00:00 - INFO - Database connected        ‚îÇ
‚îÇ [web] 2026-02-09 12:00:01 - INFO - Web service started        ‚îÇ
‚îÇ [bot] 2026-02-09 12:00:02 - INFO - Bot polling started        ‚îÇ
‚îÇ                       Ctrl+C to stop all services             ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

–ü–∞–Ω–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è 2 —Ä–∞–∑–∞ –≤ —Å–µ–∫—É–Ω–¥—É. –°—Ç–∞—Ç—É—Å—ã:
- `‚óè RUNNING` (–∑–µ–ª—ë–Ω—ã–π) ‚Äî –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç
- `üîÑ STARTING` (–∂—ë–ª—Ç—ã–π) ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- `‚úñ CRASHED` (–∫—Ä–∞—Å–Ω—ã–π) ‚Äî –ø—Ä–æ—Ü–µ—Å—Å —É–ø–∞–ª
- `‚óã STOPPED` (—Å–µ—Ä—ã–π) ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `‚è≥ PENDING` (—Å–µ—Ä—ã–π) ‚Äî –æ–∂–∏–¥–∞–µ—Ç –∑–∞–ø—É—Å–∫–∞

---

## Foreground-—Ä–µ–∂–∏–º (`--service`)

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ ‚Äî –∑–∞–ø—É—Å–∫ –±–µ–∑ –¥–∞—à–±–æ—Ä–¥–∞, —Å –ø—Ä—è–º—ã–º –≤—ã–≤–æ–¥–æ–º
–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç `.env`, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `PYTHONPATH`
–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `os.execvp()` ‚Äî –∑–∞–º–µ—â–∞–µ—Ç —Å–µ–±—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Å–µ—Ä–≤–∏—Å–∞.

```bash
python orchestrator.py --service web
```

–í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ **–Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**.
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `db` —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π API

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –∏–∑ Python-–∫–æ–¥–∞:

```python
from orchestrator import run_single_service, Orchestrator
from pathlib import Path

# –ó–∞–ø—É—Å–∫ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –≤ foreground
run_single_service("db")

# –ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –¥–∞—à–±–æ—Ä–¥–æ–º
env_file = Path("infrastructure/.env")
orch = Orchestrator(["db", "web"], env_file)
orch.run()
```

---

## –û–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –ø—É—Ç–∏

### PYTHONPATH

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `PYTHONPATH=infrastructure/`
–¥–ª—è –≤—Å–µ—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –ö–∞–∂–¥—ã–π `main.py` —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ—Ä–µ–Ω—å
infrastructure –≤ `sys.path` —á–µ—Ä–µ–∑ `sys.path.append(...)`.

–ü—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –±–µ–∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ `PYTHONPATH` –∑–∞–¥–∞–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ ‚Äî
–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å `python main.py` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å–µ—Ä–≤–∏—Å–∞.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –µ–¥–∏–Ω–æ–º `infrastructure/.env`.
–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ `python-dotenv` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç
–¥–æ—á–µ—Ä–Ω–∏–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º —á–µ—Ä–µ–∑ `env` –ø–∞—Ä–∞–º–µ—Ç—Ä `subprocess.Popen`.

---

## –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

- –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã–≤–æ–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ
  —Å—Ç—Ä–æ–∫–∏ –µ–≥–æ –ª–æ–≥–æ–≤ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã ‚Äî –¥–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `‚úñ CRASHED`,
  –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
- –ü—Ä–∏ Ctrl+C ‚Äî graceful shutdown –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

---

## –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä

- **–ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç PostgreSQL** ‚Äî –°–£–ë–î –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- **–ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç Next.js** ‚Äî —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `web/` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- **–ù–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —É–ø–∞–≤—à–∏–µ —Å–µ—Ä–≤–∏—Å—ã** ‚Äî –ø—Ä–∏ –∫—Ä–∞—à–µ –≤—Å—ë –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
  (–¥–ª—è –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ systemd)
